# UART

![image-20241216201645161](C:\Users\47302\AppData\Roaming\Typora\typora-user-images\image-20241216201645161.png)

波特率：1S多少个bit。就是1/波特率

假设9600，芯片每104us接受一个数据，直到8个停止

全双工

一般不通信的时候都是高电平，当收到起始位（低电平）开始，当结束时，是转换成高电平，然后持续高电平。

![image-20241216203331614](assets/image-20241216203331614.png)

数据位可以选择5-8位，一般是8位

奇偶校验：就是有几个1，偶数个1就是偶

小端通信，先发低位。



# I2C

![image-20241216212137181](assets/image-20241216212137181.png)

SCL是固定的信号线，主设备发出。

SDA从高到低，是起始位。SDA从低到高，是结束位。

应答位是1的话，就是数据错误或无应答

应答位是0的话，就是数据无异常

## 发送多帧数据

![image-20241216212359325](assets/image-20241216212359325.png)

一次发8位，可以每8个应答一次，然后接着发，不用重新起始。

### 读取和写入

![image-20241216212804786](assets/image-20241216212804786.png)

第一帧的前7位，表示器件的地址，从设备地址。最后一位(第8位)表示读还是写

0是写，1是读取

第二帧一般是寄存器地址。

![image-20241216213027095](assets/image-20241216213027095.png)

里面也有不能随意使用的地址。

# SPI

4根线CS、CLK、MISO、MOSI

CS：一般低电平有效，具体看芯片手册

CLK：主设备提供，绝对通信速度

MISO:主设备的输出

MOSI：主设备的输入

### SPI一主多从

常规方式，用多个CS引脚

![image-20241216221141446](assets/image-20241216221141446.png)

菊花链方式，用1个CS引脚

![image-20241216221302023](assets/image-20241216221302023.png)

### **SPI的采样方式**

SPI的采样方式由时钟极性（CPOL）和时钟相位（CPHA）的组合决定。每种组合定义了数据的采样和传输时机。SPI支持以下**4种采样模式**：

| CPOL | CPHA | 数据采样时间       | 空闲时钟电平 |
| ---- | ---- | ------------------ | ------------ |
| 0    | 0    | 时钟**上升沿采样** | 时钟空闲为低 |
| 0    | 1    | 时钟**下降沿采样** | 时钟空闲为低 |
| 1    | 0    | 时钟**下降沿采样** | 时钟空闲为高 |
| 1    | 1    | 时钟**上升沿采样** | 时钟空闲为高 |

- **CPOL (时钟极性)**
  决定了SPI总线空闲时的时钟电平：
  - CPOL = 0：时钟空闲为低电平
  - CPOL = 1：时钟空闲为高电平
- **CPHA (时钟相位)**
  决定了数据采样是在时钟的第一个沿（上升沿或下降沿）还是第二个沿：
  - CPHA = 0：数据在第一个沿采样（时钟边沿前的数据为稳定状态）
  - CPHA = 1：数据在第二个沿采样（时钟边沿后的数据为稳定状态）

**总结：SPI 有 4 种采样方式，CPOL 和 CPHA 的组合决定了具体时序行为。**

### **SPI一次传输的位数**

SPI的单次传输位数是灵活的，主要取决于设备的配置和硬件支持：

1. **理论上：**
   SPI一次传输的数据位数并没有固定的限制，具体取决于SPI外设寄存器的配置和硬件协议的实现。常见的配置包括**8位、16位、32位**等。
   
2. **MCU硬件支持：**
   - 对于STM32等微控制器：
     - 常见的传输长度为 **8位** 或 **16位**。
   - 数据位数通常由SPI控制器的寄存器决定，例如STM32的**SPI_CR2寄存器中的DS[3:0]字段**可以设置传输数据宽度。
   
   ##### STM32F722中可以自行设置，传输长度4bit-16bit都可以
   
   SPI中有TI和摩托罗拉两种，常用摩托罗拉
   
   ​	主要区别是摩托罗拉可以配置4个工作模式,TI只能配置1种。TI的SPI一般固定为 CPOL = 0，CPHA =1
   
   3.SPI中主设备和从设备的传输长度要一样。
   
   4。SPI的本质是数据交换，想接受，必须先发送才行。

### DSPI和QSPI

![image-20241216222049996](assets/image-20241216222049996.png)

在标准下，一个方向只有一根线。

![image-20241216222115741](assets/image-20241216222115741.png)

![image-20241216222126871](assets/image-20241216222126871.png)

### 系统框图

![image-20241217162847378](assets/image-20241217162847378.png)

# I2C和SPI对比

![image-20241216220700898](assets/image-20241216220700898.png)

# CAN

CAN帧的种类
• 每一个节点都可以主动发送帧。(帧是CAN协议规定的发送或接收的单位) 。帧由段组成，段由二进制位组成。

序号	名称	帧用途
1	数据帧	用于发送单元向接收单元传送数据的帧。
2	遥控帧	用于接收单元向具有相同 ID 的发送单元请求数据的帧。
3	错误帧	用于当检测出错误时向其它单元通知错误的帧。 （硬件自动完成）
4	过载帧	当一个节点正忙于处理接收的信息,可以通知其它节点暂缓发送新报文。（硬件自动完成）
5	帧间隔	用于将数据帧及遥控帧与前面的帧分离开来的帧（硬件自动完成）

（1）遥控帧

![img](https://i-blog.csdnimg.cn/blog_migrate/61d04b87ff97750f937ef85087cc73c9.png#pic_center)

数据帧和远程帧结构上差不多，最大的区别就是远程帧没有数据段。 数据帧也是最复杂的帧，所以我们重点解析下面要讲的数据帧。

（2）数据帧

![img](https://i-blog.csdnimg.cn/blog_migrate/4d43c42926747a2f1b42286fd3f17cb4.png#pic_center)

序号	名称	描述
1	帧起始	表示帧的开始，产生一个bit的显性电平。
2	仲裁段	表示帧的优先级， 由标识符（ID）和传送帧类型(RTR)组成。
3	控制端	表示数据的字节数，由6个bit构成
4	数据段	数据的具体内容，可发送0～8 个字节的数据。
5	CRC段	用于校验传输是否正确。
6	ACK段	表示确认是否正常接收。
7	帧结束	表示此帧结束。

# ADC

adc有多种类型。STM32中使用的是逐次逼近型

主要是二分搜索算法
![image-20241217011420169](assets/image-20241217011420169.png)

![image-20241217011450974](assets/image-20241217011450974.png)

![image-20241217180238543](assets/image-20241217180238543.png)

# DAC

![image-20241217013919084](assets/image-20241217013919084.png)







# 启动过程

![image-20241225194306195](assets/image-20241225194306195.png)



![image-20241225194702415](assets/image-20241225194702415.png)

